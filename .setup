#!/bin/bash

#-----------------------------------------------------------------------------
# boilerplate.sh
#-----------------------------------------------------------------------------

# get current path
HERE="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
echo "HERE | ${HERE}"

SEARCH_PATH=("${HERE}" "${HERE}"/lib "${HERE}"/.. "${HERE}"/../lib .)
MODULES=(logger.include color.include)
LOADED_MODULES=()
for module in "${MODULES[@]}"
do
	OK=KO
	for here in "${SEARCH_PATH[@]}"
	do
		# printf "TRY  | . %-50.50s" "${here}/${module}"
		if . "${here}/${module}" &> /dev/null
		then
			OK=OK
			LOADED_MODULES+=("${here}/${module}")
			# echo "| OK   | . ${here}/${module}"
			break
		fi
		# echo "| FAIL | . ${here}/${module}"
	done
	[ "${OK}" == OK ] || {
		echo "FATAL | cannot find ${module}"
		exit 255
	}
done

#
#	setup variables and log level
#
HERE="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
NAME="$(basename ${BASH_SOURCE[0]})"	# save this script name
info "HERE | $HERE"
info "NAME | $NAME"
for module in "${LOADED_MODULES[@]}"
do
	info "loaded module ${module}"
done
logger_setlevel info

#-----------------------------------------------------------------------------
# boilerplate.sh
#-----------------------------------------------------------------------------
